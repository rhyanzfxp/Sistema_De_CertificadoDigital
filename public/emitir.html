<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Emitir Certificado</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2>Emitir Certificado</h2>
        <form id="emitForm">
          <h5>Dados do Aluno</h5>
          <div class="mb-3">
            <label class="form-label">Aluno ID</label>
            <input class="form-control" name="alunoId" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Aluno Nome</label>
            <input class="form-control" name="alunoNome" required>
          </div>
          <h5>Atividade</h5>
          <div class="mb-3">
            <label class="form-label">Nome da Atividade</label>
            <input class="form-control" name="atividadeNome" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Carga Horária</label>
            <input class="form-control" name="cargaHoraria" required type="number" min="1">
          </div>
          <div class="mb-3">
            <label class="form-label">Data (YYYY-MM-DD)</label>
            <input class="form-control" name="data" required placeholder="2025-10-16">
          </div>
          <div class="mb-3">
            <label class="form-label">Responsável (Nome)</label>
            <input class="form-control" name="responsavelNome" required>
          </div>
          <button class="btn btn-success" type="submit">Emitir</button>
        </form>

        <div id="result" class="mt-4"></div>
      </div>
    </div>
  </div>

<script>
document.getElementById('emitForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = e.target;
  const body = {
    aluno: { id: f.alunoId.value, nome: f.alunoNome.value },
    atividade: { nome: f.atividadeNome.value },
    cargaHoraria: f.cargaHoraria.value,
    data: f.data.value,
    responsavel: { nome: f.responsavelNome.value }
  };
  const res = await fetch('/api/certificados/emitir', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(body)
  });
  const data = await res.json();
  const div = document.getElementById('result');
  if(res.ok){
    div.innerHTML = `<div class="alert alert-success">Emitido! ID: <strong>${data.id}</strong><br>Hash: ${data.hash}<br><a href="${data.urlDownload}" class="btn btn-sm btn-primary mt-2">Baixar PDF</a> <a href="${data.urlVerificacao}" target="_blank" class="btn btn-sm btn-outline-secondary mt-2">Verificar</a></div>`;
  } else {
    div.innerHTML = `<div class="alert alert-danger">Erro: ${data.error || JSON.stringify(data)}</div>`;
  }
});
</script>
</body>
</html>
